<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EatWhere</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #ff6f00;
      color: white;
      padding: 1rem;
      text-align: center;
      animation: fadeInDown 1s ease;
    }
    nav {
      background-color: #ff8f00;
      padding: 0.75rem;
      display: flex;
      justify-content: center;
      gap: 2rem;
      animation: fadeIn 1.5s ease;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s;
    }
    nav a:hover {
      color: #000;
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 1rem;
      animation: fadeInUp 1s ease;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 2rem;
      animation: fadeIn 1.2s ease;
    }
    select, button {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid #ccc;
    }
    .restaurant-card {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      animation: fadeSlideIn 0.8s ease forwards;
    }
    .restaurant-card img {
      width: 150px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
    }
    .restaurant-info {
      flex-grow: 1;
    }
    .restaurant-name {
      font-size: 1.2rem;
      font-weight: bold;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: #eee;
      animation: fadeInUp 1.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeInDown {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NPWVQS7KKC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NPWVQS7KKC');
</script>
</head>
<body>
  <header>
    <h1>EatWhere üçú</h1>
    <p>Good food around you ‚Äì <strong>EatWhere.Food</strong></p>
  </header>
  <nav>
    <a href="/">Home</a>
    <a href="/explore">Explore</a>
    <a href="/about">About</a>
    <a href="/new">New</a>
  </nav>
  <div class="container">
    <div class="filters">
      <select id="filter-cuisine">
        <option value="">All Cuisines</option>
         <% cuisines.forEach(cuisine => { %>
            <option value=<%= cuisine %>><%= cuisine %></option>
          <% }); %>
      </select>
      <select id="filter-halal">
        <option value="">Halal?</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
      <select id="filter-price">
        <option value="">Price?</option>
        <option value="$">$</option>
        <option value="$$">$$</option>
        <option value="$$$">$$$</option>
        <option value="$$$$">$$$$</option>
      </select>
      <select id="filter-vegetarian">
        <option value="">Vegetarian?</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>
      <button onclick="filterRestaurants()">Search</button>
      <button onclick="goLucky()">üé≤ Go Lucky!</button>
    </div>
    <div id="restaurant-list"></div>
  </div>
  <footer>
    &copy; 2025 EatWhere.Food. All makan rights reserved.
    <p>Disclaimer:
    This website is created for learning purposes only. The information provided here should not be considered professional advice. Please note that we make no guarantees regarding the accuracy, completeness, or reliability of the contents of this website. Any actions you take based on the contents of this website are at your own risk. We are not liable for any losses or damages incurred from the use of this website.</p>
  </footer>

  <script>
  let allRestaurants = [];

  async function fetchRestaurants() {
    try {
      const response = await fetch('/api/restaurants');
      const data = await response.json();
      console.log("‚úÖ Fetched data:", data);
      allRestaurants = data;
      return data;
    } catch (error) {
      console.error("‚ùå Failed to fetch restaurants:", error);
      return [];
    }
  }

  async function renderList(data) {
    const container = document.getElementById("restaurant-list");
    container.innerHTML = "";
    if (data.length === 0) {
      container.innerHTML = "<p>No results found.</p>";
      return;
    }

    let restaurants = '';
    data.forEach((r) => {
      if (!r.Location || !r.Name) return;

      restaurants += `
        <div class="restaurant-card">
          <img src="${r.Image_URL}" alt="${r.Name}" />
          <div class="restaurant-info">
            <div class="restaurant-name">${r.Name}</div>
            <p>${r.Cuisine} ‚Ä¢ Halal: ${r.Halal} ‚Ä¢ Vegetarian: ${r.Vegetarian}</p>
            <p>Location: ${r.Location} ‚Ä¢ Price: ${r.Price} ‚Ä¢ Distance: ${r.Distance}</p>
            <p><em>Review:</em> ${r.Review || 'N/A'}</p>
          </div>
        </div>
      `;
    });

    container.innerHTML = restaurants;
  }

  async function filterRestaurants() {
    const cuisine = document.getElementById("filter-cuisine").value.toLowerCase().trim();
    const halal = document.getElementById("filter-halal").value.toLowerCase().trim();
    const vegetarian = document.getElementById("filter-vegetarian").value.toLowerCase().trim();

    if (allRestaurants.length === 0) await fetchRestaurants();

    const results = allRestaurants.filter((r) => {
      const matchCuisine = cuisine === "" || (r.Cuisine || "").toLowerCase().includes(cuisine);
      const matchHalal = halal === "" || (r.Halal || "").toLowerCase() === halal;
      const matchVegetarian = vegetarian === "" || (r.Vegetarian || "").toLowerCase() === vegetarian;
      return matchCuisine && matchHalal && matchVegetarian;
    });

    renderList(results);
  }

  async function goLucky() {
    if (allRestaurants.length === 0) await fetchRestaurants();
    const random = allRestaurants[Math.floor(Math.random() * allRestaurants.length)];
    renderList([random]);
  }

  // No auto-load on page load
  window.onload = () => {
    console.log("üïí Waiting for user action to fetch restaurants.");
  };
</script>

</body>
</html>
